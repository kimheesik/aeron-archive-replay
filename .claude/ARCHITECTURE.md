# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)

**í”„ë¡œì íŠ¸**: Aeron ê¸°ë°˜ ê³ ì„±ëŠ¥ ë©”ì‹œì§• ì‹œìŠ¤í…œ
**ë²„ì „**: v1.0
**ì‘ì„±ì¼**: 2025-11-20

---

## ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì „ì²´ ì•„í‚¤í…ì²˜](#ì „ì²´-ì•„í‚¤í…ì²˜)
3. [í”„ë¡œì„¸ìŠ¤ êµ¬ì¡°](#í”„ë¡œì„¸ìŠ¤-êµ¬ì¡°)
4. [ë©”ì‹œì§€ í”„ë¡œí† ì½œ](#ë©”ì‹œì§€-í”„ë¡œí† ì½œ)
5. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
6. [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#ë””ë ‰í† ë¦¬-êµ¬ì¡°)
7. [ì„±ëŠ¥ ì•„í‚¤í…ì²˜](#ì„±ëŠ¥-ì•„í‚¤í…ì²˜)

---

## ì‹œìŠ¤í…œ ê°œìš”

### ì•„í‚¤í…ì²˜ íŒ¨í„´
- **Publisher-Subscriber íŒ¨í„´**
- **3-Process ì‹œìŠ¤í…œ**
- **Event-Driven ì•„í‚¤í…ì²˜**
- **Zero-Copy ë©”ì‹œì§€ ì²˜ë¦¬**

### í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ
- **Aeron v1.50.1**: ê³ ì„±ëŠ¥ ë©”ì‹œì§• í”„ë ˆì„ì›Œí¬
- **C++17**: Publisher/Subscriber êµ¬í˜„
- **Java 17**: ArchivingMediaDriver
- **Lock-free Queue**: SPSC Queue ê¸°ë°˜ ëª¨ë‹ˆí„°ë§

---

## ì „ì²´ ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Host System                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         ArchivingMediaDriver (Java)                     â”‚   â”‚
â”‚  â”‚         Port: 8010                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ MediaDriver  â”‚  â”‚   Archive    â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  Recording   â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  Replay      â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                     â”‚                            â”‚
â”‚        Archive Control      Aeron Shared Memory                â”‚
â”‚              â”‚              (/home/hesed/shm/aeron)            â”‚
â”‚              â”‚                     â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Publisher (C++)    â”‚  â”‚   Subscriber (C++)          â”‚    â”‚
â”‚  â”‚                      â”‚  â”‚                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ AeronPublisher â”‚ â”‚  â”‚  â”‚  3-Thread System       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                â”‚ â”‚  â”‚  â”‚                        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - MessageBufferâ”‚ â”‚  â”‚  â”‚  [Main Thread]         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - Recording    â”‚ â”‚  â”‚  â”‚  - Aeron Subscription  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   Controller   â”‚ â”‚  â”‚  â”‚  - Message Reception   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  - Queue Enqueue       â”‚ â”‚    â”‚
â”‚  â”‚                      â”‚  â”‚  â”‚                        â”‚ â”‚    â”‚
â”‚  â”‚                      â”‚  â”‚  â”‚  [Worker Thread]       â”‚ â”‚    â”‚
â”‚  â”‚  UDP localhost:40456 â”‚  â”‚  â”‚  - Queue Dequeue       â”‚ â”‚    â”‚
â”‚  â”‚  Stream ID: 10       â”‚  â”‚  â”‚  - Message Processing  â”‚ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  - Business Logic      â”‚ â”‚    â”‚
â”‚             â”‚               â”‚  â”‚                        â”‚ â”‚    â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚  [Monitoring Thread]   â”‚ â”‚    â”‚
â”‚                             â”‚  â”‚  - Stats Collection    â”‚ â”‚    â”‚
â”‚                             â”‚  â”‚  - Real-time Output    â”‚ â”‚    â”‚
â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í”„ë¡œì„¸ìŠ¤ êµ¬ì¡°

### 1. ArchivingMediaDriver (Java)

**ì—­í• **: ë©”ì‹œì§€ ì „ì†¡ ì¸í”„ë¼ + Recording/Replay

**ì£¼ìš” ê¸°ëŠ¥**:
- MediaDriver: UDP ë©”ì‹œì§€ ì „ì†¡ ê´€ë¦¬
- Archive: ë©”ì‹œì§€ ë…¹í™”/ì¬ìƒ ì„œë¹„ìŠ¤
- Recording Control: ë…¹í™” ì‹œì‘/ì¤‘ì§€ ì œì–´

**ì„¤ì •**:
```bash
- Control Channel: localhost:8010
- Aeron Directory: /home/hesed/shm/aeron
- Archive Directory: /home/hesed/shm/aeron-archive
- Threading Mode: SHARED
```

**í”„ë¡œì„¸ìŠ¤ ìˆ˜ëª…**: ì‹œìŠ¤í…œ êµ¬ë™ ì‹œ ê°€ì¥ ë¨¼ì € ì‹œì‘, ë§ˆì§€ë§‰ì— ì¢…ë£Œ

---

### 2. Publisher (C++)

**ì—­í• **: ë©”ì‹œì§€ ë°œí–‰ ë° ë…¹í™” ì œì–´

**ì£¼ìš” ì»´í¬ë„ŒíŠ¸**:

```cpp
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AeronPublisher                 â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Aeron Context               â”‚  â”‚
â”‚  â”‚  - MediaDriver (embedded)    â”‚  â”‚
â”‚  â”‚  - Publication               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RecordingController         â”‚  â”‚
â”‚  â”‚  - Archive Client            â”‚  â”‚
â”‚  â”‚  - startRecording()          â”‚  â”‚
â”‚  â”‚  - stopRecording()           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MessageBuffer Builder       â”‚  â”‚
â”‚  â”‚  - 64-byte Header            â”‚  â”‚
â”‚  â”‚  - Payload                   â”‚  â”‚
â”‚  â”‚  - Sequence numbering        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹¤í–‰ íë¦„**:
1. Aeron ì´ˆê¸°í™” (embedded MediaDriver)
2. Publication ìƒì„± (UDP localhost:40456, stream 10)
3. Archive ì—°ê²° (localhost:8010)
4. ë©”ì‹œì§€ ë°œí–‰ ë£¨í”„:
   - MessageBuffer ìƒì„±
   - Sequence number í• ë‹¹
   - Timestamp ì„¤ì •
   - Publication->offer()
5. Recording ì œì–´ (start/stop ëª…ë ¹)

---

### 3. Subscriber (C++)

**ì—­í• **: ë©”ì‹œì§€ ìˆ˜ì‹  ë° ì²˜ë¦¬

**Zero-Copy 3-Thread Subscriber** (ê¸°ë³¸ êµ¬í˜„) â­
**ìµœê³  ì„±ëŠ¥ì˜ ë‹¨ì¼ ë²„ì „**

- Lock-free ëª¨ë‹ˆí„°ë§ (SPSC Queue)
- 3-Thread ì•„í‚¤í…ì²˜
- Buffer Pool + Message Queue
- 100ê±´ë§ˆë‹¤ ì‹¤ì‹œê°„ í†µê³„ ì¶œë ¥
- 0.009% ì˜¤ë²„í—¤ë“œ
- 0.76Î¼s í‰ê·  ì²˜ë¦¬ ì‹œê°„

**3-Thread ì•„í‚¤í…ì²˜**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Main Thread (Subscriber)                  â”‚
â”‚                                                               â”‚
â”‚  Aeron Subscription -> onFragment() -> handleMessage()       â”‚
â”‚                                 â”‚                             â”‚
â”‚                                 â–¼                             â”‚
â”‚                        Parse MessageBuffer                    â”‚
â”‚                                 â”‚                             â”‚
â”‚                                 â–¼                             â”‚
â”‚                        Buffer Pool Acquire                    â”‚
â”‚                                 â”‚                             â”‚
â”‚                                 â–¼                             â”‚
â”‚                        Message Queue Enqueue  (Lock-free)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker Thread               â”‚  â”‚  Monitoring Thread          â”‚
â”‚                              â”‚  â”‚                             â”‚
â”‚  Message Queue Dequeue       â”‚  â”‚  Stats Queue Dequeue        â”‚
â”‚         â”‚                    â”‚  â”‚         â”‚                   â”‚
â”‚         â–¼                    â”‚  â”‚         â–¼                   â”‚
â”‚  Process Message             â”‚  â”‚  Calculate Stats            â”‚
â”‚  - Validate                  â”‚  â”‚  - Min/Max/Avg Latency      â”‚
â”‚  - Check Duplicate           â”‚  â”‚  - Message Count            â”‚
â”‚  - Type-specific Handler     â”‚  â”‚  - Queue Usage              â”‚
â”‚         â”‚                    â”‚  â”‚         â”‚                   â”‚
â”‚         â–¼                    â”‚  â”‚         â–¼                   â”‚
â”‚  Buffer Pool Release         â”‚  â”‚  Print Statistics           â”‚
â”‚         â”‚                    â”‚  â”‚  (Every 100 messages)       â”‚
â”‚         â–¼                    â”‚  â”‚                             â”‚
â”‚  Stats Queue Enqueue         â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì£¼ìš” ì»´í¬ë„ŒíŠ¸**:
- **Buffer Pool**: ë©”ëª¨ë¦¬ ì¬ì‚¬ìš© (1024 buffers x 4096 bytes)
- **Message Queue**: Lock-free SPSC Queue (16K capacity)
- **Stats Queue**: ëª¨ë‹ˆí„°ë§ìš© SPSC Queue (16K capacity)

---

## ë©”ì‹œì§€ í”„ë¡œí† ì½œ

### MessageBuffer êµ¬ì¡°

```cpp
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MessageHeader (64 bytes)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Magic Number [4 bytes]      "SEKR"                       â”‚
â”‚  Version [2 bytes]           0x0001                       â”‚
â”‚  Message Type [2 bytes]      MSG_TEST = 99                â”‚
â”‚  Sequence Number [8 bytes]   Monotonic counter            â”‚
â”‚  Event Time [8 bytes]        Nanoseconds since epoch      â”‚
â”‚  Publish Time [8 bytes]      Publisher timestamp          â”‚
â”‚  Receive Time [8 bytes]      Subscriber fills this        â”‚
â”‚  Message Length [4 bytes]    Total size (header + body)   â”‚
â”‚  Publisher ID [2 bytes]      Publisher identifier         â”‚
â”‚  Priority [1 byte]           0-255                        â”‚
â”‚  Flags [1 byte]              Bit flags                    â”‚
â”‚  Session ID [8 bytes]        Replay session tracking      â”‚
â”‚  Checksum [4 bytes]          CRC32 (TODO)                 â”‚
â”‚  Reserved [4 bytes]          Future use                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Payload (Variable)                        â”‚
â”‚  - Order messages                                          â”‚
â”‚  - Execution messages                                      â”‚
â”‚  - Test data                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ì‹œì§€ íƒ€ì…

| íƒ€ì… | ì½”ë“œ | ì„¤ëª… | êµ¬í˜„ ìƒíƒœ |
|------|------|------|-----------|
| MSG_TEST | 99 | í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ | âœ… ì™„ë£Œ |
| MSG_ORDER_NEW | 1 | ì‹ ê·œ ì£¼ë¬¸ | â³ TODO |
| MSG_ORDER_EXECUTION | 2 | ì£¼ë¬¸ ì²´ê²° | â³ TODO |
| MSG_ORDER_MODIFY | 3 | ì£¼ë¬¸ ì •ì • | â³ TODO |
| MSG_ORDER_CANCEL | 4 | ì£¼ë¬¸ ì·¨ì†Œ | â³ TODO |

---

## ë°ì´í„° íë¦„

### Live Streaming (ì‹¤ì‹œê°„ ë©”ì‹œì§€)

```
Publisher                    Aeron                    Subscriber
    â”‚                          â”‚                          â”‚
    â”‚ 1. Create MessageBuffer  â”‚                          â”‚
    â”‚    - Header (64 bytes)   â”‚                          â”‚
    â”‚    - Sequence number     â”‚                          â”‚
    â”‚    - Timestamps          â”‚                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚ 2. publication->offer()  â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚ 3. UDP localhost:40456   â”‚
    â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 4. onFragment()
    â”‚                          â”‚                          â”‚    - Parse header
    â”‚                          â”‚                          â”‚    - Validate
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 5. Queue->enqueue()
    â”‚                          â”‚                          â”‚    (Main Thread)
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 6. Queue->dequeue()
    â”‚                          â”‚                          â”‚    (Worker Thread)
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 7. Process message
    â”‚                          â”‚                          â”‚    - Check duplicate
    â”‚                          â”‚                          â”‚    - Handle type
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 8. Stats->enqueue()
    â”‚                          â”‚                          â”‚    (Worker Thread)
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚                          â”‚ 9. Print stats
    â”‚                          â”‚                          â”‚    (Monitoring Thread)
```

### Recording Flow (ë…¹í™”)

```
Publisher                 Archive                 Disk
    â”‚                       â”‚                       â”‚
    â”‚ 1. start command      â”‚                       â”‚
    â”‚                       â”‚                       â”‚
    â”‚ 2. startRecording()   â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
    â”‚                       â”‚ 3. Create recording   â”‚
    â”‚                       â”‚    metadata           â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                       â”‚                       â”‚
    â”‚ 4. Publish messages   â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
    â”‚                       â”‚ 5. Write to disk      â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                       â”‚   (*.rec files)       â”‚
    â”‚                       â”‚                       â”‚
    â”‚ 5. stop command       â”‚                       â”‚
    â”‚                       â”‚                       â”‚
    â”‚ 6. stopRecording()    â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
    â”‚                       â”‚ 7. Finalize recording â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
```

### ReplayMerge Flow (ì¬ìƒ â†’ ì‹¤ì‹œê°„ ì „í™˜)

```
Subscriber              Archive                Publisher
    â”‚                     â”‚                       â”‚
    â”‚ 1. --replay-auto    â”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 2. List recordings  â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 3. Find latest      â”‚                       â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚   recording_id=1    â”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 4. startReplay()    â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 5. Replay messages  â”‚                       â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚   [REPLAY] tags     â”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 6. Replay complete  â”‚                       â”‚
    â”‚   (auto-detect)     â”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 7. Transition to    â”‚                       â”‚
    â”‚    live mode        â”‚                       â”‚
    â”‚                     â”‚                       â”‚
    â”‚ 8. Receive live     â”‚                       â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   [LIVE] tags       â”‚                       â”‚
```

---

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
/home/hesed/devel/aeron/
â”‚
â”œâ”€â”€ .claude/                      # Claude Code í•µì‹¬ ë¬¸ì„œ
â”‚   â”œâ”€â”€ PROJECT_STATUS.md         # í˜„ì¬ ì§„í–‰ì‚¬í•­
â”‚   â”œâ”€â”€ ARCHITECTURE.md           # ì´ ë¬¸ì„œ
â”‚   â”œâ”€â”€ TODO.md                   # ë‹¤ìŒ ì‘ì—… ëª©ë¡
â”‚   â””â”€â”€ DECISIONS.md              # ì£¼ìš” ì„¤ê³„ ê²°ì •ì‚¬í•­
â”‚
â”œâ”€â”€ common/                       # ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”œâ”€â”€ AeronConfig.h         # ì¤‘ì•™ ì„¤ì • (ì±„ë„, í¬íŠ¸, ìŠ¤íŠ¸ë¦¼ ID)
â”‚   â”‚   â”œâ”€â”€ Logger.h              # ë¡œê¹… ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â””â”€â”€ MessageBuffer.h       # ë©”ì‹œì§€ í”„ë¡œí† ì½œ ì •ì˜ â­
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ ConfigLoader.cpp      # INI ì„¤ì • íŒŒì¼ ë¡œë” (405 lines)
â”‚       â””â”€â”€ Logger.cpp
â”‚
â”œâ”€â”€ publisher/                    # Publisher ëª¨ë“ˆ
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”œâ”€â”€ AeronPublisher.h
â”‚   â”‚   â””â”€â”€ RecordingController.h
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ AeronPublisher.cpp    # ë©”ì‹œì§€ ë°œí–‰ (226 lines)
â”‚       â”œâ”€â”€ RecordingController.cpp # ë…¹í™” ì œì–´ (228 lines)
â”‚       â””â”€â”€ main.cpp
â”‚
â”œâ”€â”€ subscriber/                   # Subscriber ëª¨ë“ˆ
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”œâ”€â”€ AeronSubscriber.h     # ê¸°ë³¸ êµ¬ë…ì
â”‚   â”‚   â”œâ”€â”€ BufferPool.h          # Zero-copy buffer pool â­
â”‚   â”‚   â”œâ”€â”€ MessageQueue.h        # Lock-free message queue â­
â”‚   â”‚   â”œâ”€â”€ MessageWorker.h       # Worker thread â­
â”‚   â”‚   â””â”€â”€ SPSCQueue.h           # Single Producer Single Consumer Queue
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ AeronSubscriber.cpp   # ê¸°ë³¸ êµ¬ë… + ë ˆì´í„´ì‹œ ì¸¡ì • (337 lines)
â”‚       â”œâ”€â”€ subscriber_monitoring_example.cpp    # ëª¨ë‹ˆí„°ë§ ì˜ˆì œ
â”‚       â””â”€â”€ subscriber_zerocopy_example.cpp      # Zero-copy ì˜ˆì œ â­
â”‚
â”œâ”€â”€ config/                       # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ aeron-local.ini           # ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ aeron-distributed.ini     # ë¶„ì‚° í™˜ê²½ ì„¤ì •
â”‚   â””â”€â”€ *.ini
â”‚
â”œâ”€â”€ scripts/                      # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ start_archive_driver.sh   # ArchivingMediaDriver ì‹œì‘
â”‚   â”œâ”€â”€ build.sh                  # ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ latency_test.sh           # ë ˆì´í„´ì‹œ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ performance_test.sh       # ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ build/                        # ë¹Œë“œ ì¶œë ¥ (CMake)
â”‚   â”œâ”€â”€ publisher/aeron_publisher
â”‚   â”œâ”€â”€ subscriber/aeron_subscriber
â”‚   â”œâ”€â”€ subscriber/aeron_subscriber_monitored
â”‚   â””â”€â”€ subscriber/aeron_subscriber_zerocopy
â”‚
â”œâ”€â”€ CLAUDE.md                     # Claude Code ë¹ ë¥¸ ë ˆí¼ëŸ°ìŠ¤
â”œâ”€â”€ CMakeLists.txt                # ë£¨íŠ¸ ë¹Œë“œ ì„¤ì •
â””â”€â”€ test_message_publisher.cpp    # Standalone í…ŒìŠ¤íŠ¸ Publisher
```

---

## ì„±ëŠ¥ ì•„í‚¤í…ì²˜

### Zero-Copy ê²½ë¡œ

**ëª©í‘œ**: ë©”ëª¨ë¦¬ ë³µì‚¬ ìµœì†Œí™”ë¡œ CPU ì‚¬ìš©ë¥  ê°ì†Œ ë° ë ˆì´í„´ì‹œ ë‹¨ì¶•

```
Aeron Shared Memory Buffer (4KB aligned)
         â”‚
         â”‚ (No Copy)
         â–¼
onFragment(AtomicBuffer&, offset, length)
         â”‚
         â”‚ (Pointer Cast)
         â–¼
const MessageHeader* header = buffer.buffer() + offset
         â”‚
         â”‚ (Acquire from Pool)
         â–¼
BufferPool::acquire() -> Preallocated buffer
         â”‚
         â”‚ (Single memcpy)
         â–¼
memcpy(pool_buffer, aeron_buffer, length)
         â”‚
         â”‚ (Enqueue pointer)
         â–¼
MessageQueue::enqueue(pool_buffer)  // Lock-free
         â”‚
         â”‚ (Worker Thread)
         â–¼
MessageQueue::dequeue() -> pool_buffer
         â”‚
         â”‚ (Process in-place)
         â–¼
processMessage(pool_buffer)  // No copy
         â”‚
         â”‚ (Return to Pool)
         â–¼
BufferPool::release(pool_buffer)
```

**ì„±ëŠ¥ ë¶„ì„**:
- Aeron â†’ Handler: 0 ë³µì‚¬ (í¬ì¸í„°ë§Œ)
- Handler â†’ Buffer Pool: 1 ë³µì‚¬ (ë¶ˆê°€í”¼, ë©”ì‹œì§€ ë³´ì¡´ ìœ„í•´)
- Buffer Pool â†’ Queue: 0 ë³µì‚¬ (í¬ì¸í„°ë§Œ)
- Queue â†’ Worker: 0 ë³µì‚¬ (í¬ì¸í„°ë§Œ)
- **ì´ ë³µì‚¬ íšŸìˆ˜**: 1íšŒ (ìµœì†Œí™” ë‹¬ì„±)

### Lock-Free ì•„í‚¤í…ì²˜

**SPSC Queue íŠ¹ì„±**:
- Single Producer: ë©”ì¸ ìŠ¤ë ˆë“œë§Œ enqueue
- Single Consumer: Worker/Monitoring ìŠ¤ë ˆë“œë§Œ dequeue
- ë®¤í…ìŠ¤ ì—†ìŒ: Atomic ì—°ì‚°ë§Œ ì‚¬ìš©
- Cache-line aligned: False sharing ë°©ì§€ (64-byte)

**ë©”ëª¨ë¦¬ ìˆœì„œ**:
```cpp
// Producer (Main Thread)
buffer[write_index] = item;              // Store
write_index.store(next, memory_order_release);  // Release

// Consumer (Worker Thread)
uint32_t current_write = write_index.load(memory_order_acquire);  // Acquire
item = buffer[read_index];               // Load
read_index = next;
```

**ì„±ëŠ¥ ê²°ê³¼**:
- Enqueue: ~50 ns
- Dequeue: ~50 ns
- ì´ ì˜¤ë²„í—¤ë“œ: ~0.009% (337ns â†’ 397ns)

### Buffer Pool ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Buffer Pool                          â”‚
â”‚  (1024 buffers x 4096 bytes = 4 MB total)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Free List (std::vector<uint8_t*>)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ptrâ”‚ptr â”‚ptr â”‚ptr â”‚ptr â”‚ptr â”‚ptr â”‚ptr â”‚... â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜       â”‚
â”‚                                                          â”‚
â”‚  Operations:                                            â”‚
â”‚  - acquire(): Pop from free list (O(1))                â”‚
â”‚  - release(): Push to free list (O(1))                 â”‚
â”‚  - Mutex protected (short critical section)            â”‚
â”‚                                                          â”‚
â”‚  Metrics:                                               â”‚
â”‚  - Allocated: 20 (í†µí•© í…ŒìŠ¤íŠ¸)                         â”‚
â”‚  - Released: 20                                         â”‚
â”‚  - Failed: 0                                            â”‚
â”‚  - Efficiency: 100%                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í™•ì¥ì„± (Scalability)

### í˜„ì¬ êµ¬ì„±
- Publisher: 1 instance
- Subscriber: N instances (ë…ë¦½ êµ¬ë… ê°€ëŠ¥)
- Stream: 1 (stream ID 10)

### í™•ì¥ ì˜µì…˜

#### 1. ë‹¤ì¤‘ Stream
```cpp
// Publisher
Publication stream1 (streamId=10);  // ì£¼ë¬¸
Publication stream2 (streamId=20);  // ì²´ê²°
Publication stream3 (streamId=30);  // í˜¸ê°€

// Subscriber
Subscription stream1_sub;  // ì£¼ë¬¸ë§Œ êµ¬ë…
Subscription stream2_sub;  // ì²´ê²°ë§Œ êµ¬ë…
```

#### 2. ë‹¤ì¤‘ Publisher
```cpp
// Publisher 1 (ID=1)
header.publisher_id = 1;
sequence_1.fetch_add(1);

// Publisher 2 (ID=2)
header.publisher_id = 2;
sequence_2.fetch_add(1);

// Subscriberì—ì„œ publisher_idë³„ë¡œ ì¤‘ë³µ ì²´í¬
```

#### 3. Subscriber Sharding
```cpp
// Subscriber 1: sequence % 4 == 0
// Subscriber 2: sequence % 4 == 1
// Subscriber 3: sequence % 4 == 2
// Subscriber 4: sequence % 4 == 3
```

---

## ì¥ì•  ë³µêµ¬ (Fault Recovery)

### Recording ê¸°ë°˜ ë³µêµ¬

```
Normal Operation          Failure          Recovery
      â”‚                      â”‚                â”‚
  [Publisher]â”€â”€â”€â”€â”           â”‚                â”‚
      â”‚          â”‚           â”‚                â”‚
      â”‚      [Archive]       â”‚                â”‚
      â”‚          â”‚           â”‚                â”‚
      â–¼          â–¼           â–¼                â–¼
  [Subscriber] (Recording)  ğŸ’¥            [New Sub]
      â”‚                                        â”‚
  seq: 1000                              1. List recordings
  seq: 1001                              2. Find last seq=1001
  seq: 1002                              3. Replay from 1002
      â”‚                                        â”‚
      â”‚                                    [REPLAY]
      â”‚                                   seq: 1002
      â”‚                                   seq: 1003
      â”‚                                        â”‚
      â”‚                                   4. Transition
      â”‚                                        â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[LIVE]
      â”‚                                   seq: 1004 (real-time)
```

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-20
